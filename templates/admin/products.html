{% extends "admin/base.html" %}

{% block content %}
    <h1>Admin - Products</h1>
    <form method="POST" action="{{ url_for('admin_products') }}">
        {{ form.csrf_token }}
        {{ form.hidden_tag() }}
        {{form.title.label}}
        {{form.title}}
        {{form.category.label}}
        {{form.category}}
        {{form.amount.label}}
        {{form.amount}}
        {{form.price.label}}
        {{form.price}}
        {{form.submit}}
    </form>
    <table>
        <tr>
            <th></th>
            <th>Id</th>
            <th>Product</th>
            <th>Category Id</th>
            <th>Category Value</th>
            <th>Price</th>
            <th>Amount available</th>
        </tr>
        {% for entry in products %}
        <tr>
            <td> <a href="{{ url_for('admin_product_update', product_id=entry.id) }}"> Update</a> </td>
            <td>{{ entry.id }}</td>
            <td>{{ entry.title }}</td>
            <td>{{ entry.category_id }}</td>
            {% set matching_category = categories | selectattr('id', 'equalto', entry.category_id) | list %}
            {% if matching_category %}
                <td>{{ matching_category[0].title }}</td>
            {% else %}
                <td>No category found</td>
            {% endif %}
            <td>{{ entry.price }}</td>
            <td>{{ entry.amount_in_stock }}</td>
        </tr>
        {% endfor %}
    </table>
{% endblock content %}